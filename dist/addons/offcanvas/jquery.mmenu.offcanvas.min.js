/*	
 * jQuery mmenu offCanvas addon
 * mmenu.frebsite.nl
 *
 * Copyright (c) Fred Heusschen
 */
!function(t){var e="mmenu",o="offCanvas";t[e].addons[o]={setup:function(){if(this.opts[o]){var s=this.opts[o],i=this.conf[o];a=t[e].glbl,this._api=t.merge(this._api,["open","close","setPage"]),"top"!=s.position&&"bottom"!=s.position||(s.zposition="front"),"string"!=typeof i.pageSelector&&(i.pageSelector="> "+i.pageNodetype),a.$allMenus=(a.$allMenus||t()).add(this.$menu),this.vars.opened=!1;var r=[n.offcanvas];"left"!=s.position&&r.push(n.mm(s.position)),"back"!=s.zposition&&r.push(n.mm(s.zposition)),this.$menu.addClass(r.join(" ")).parent().removeClass(n.wrapper),t[e].support.csstransforms||this.$menu.addClass(n["no-csstransforms"]),t[e].support.csstransforms3d||this.$menu.addClass(n["no-csstransforms3d"]),this.setPage(a.$page),this._initBlocker(),this["_initWindow_"+o](),this.$menu[i.menuInjectMethod+"To"](i.menuWrapperSelector);var p=window.location.hash;if(p){var l=this._getOriginalMenuId();l&&l==p.slice(1)&&this.open()}}},add:function(){n=t[e]._c,s=t[e]._d,i=t[e]._e,n.add("offcanvas slideout blocking modal background opening blocker page no-csstransforms3d"),s.add("style"),i.add("resize")},clickAnchor:function(t,e){var s=this;if(this.opts[o]){var i=this._getOriginalMenuId();if(i&&t.is('[href="#'+i+'"]')){if(e)return!0;var r=t.closest("."+n.menu);if(r.length){var p=r.data("mmenu");if(p&&p.close)return p.close(),s.__transitionend(r,function(){s.open()},s.conf.transitionDuration),!0}return this.open(),!0}if(a.$page)return i=a.$page.first().attr("id"),i&&t.is('[href="#'+i+'"]')?(this.close(),!0):void 0}}},t[e].defaults[o]={position:"left",zposition:"back",blockUI:!0,moveBackground:!0},t[e].configuration[o]={pageNodetype:"div",pageSelector:null,noPageSelector:[],wrapPageIfNeeded:!0,menuWrapperSelector:"body",menuInjectMethod:"prepend"},t[e].prototype.open=function(){if(!this.vars.opened){var t=this;this._openSetup(),setTimeout(function(){t._openFinish()},this.conf.openingInterval),this.trigger("open")}},t[e].prototype._openSetup=function(){var e=this,r=this.opts[o];this.closeAllOthers(),a.$page.each(function(){t(this).data(s.style,t(this).attr("style")||"")}),a.$wndw.trigger(i.resize+"-"+o,[!0]);var p=[n.opened];r.blockUI&&p.push(n.blocking),"modal"==r.blockUI&&p.push(n.modal),r.moveBackground&&p.push(n.background),"left"!=r.position&&p.push(n.mm(this.opts[o].position)),"back"!=r.zposition&&p.push(n.mm(this.opts[o].zposition)),this.opts.extensions&&p.push(this.opts.extensions),a.$html.addClass(p.join(" ")),setTimeout(function(){e.vars.opened=!0},this.conf.openingInterval),this.$menu.addClass(n.current+" "+n.opened)},t[e].prototype._openFinish=function(){var t=this;this.__transitionend(a.$page.first(),function(){t.trigger("opened")},this.conf.transitionDuration),a.$html.addClass(n.opening),this.trigger("opening")},t[e].prototype.close=function(){if(this.vars.opened){var e=this;this.__transitionend(a.$page.first(),function(){e.$menu.removeClass(n.current+" "+n.opened);var i=[n.opened,n.blocking,n.modal,n.background,n.mm(e.opts[o].position),n.mm(e.opts[o].zposition)];e.opts.extensions&&i.push(e.opts.extensions),a.$html.removeClass(i.join(" ")),a.$page.each(function(){t(this).attr("style",t(this).data(s.style))}),e.vars.opened=!1,e.trigger("closed")},this.conf.transitionDuration),a.$html.removeClass(n.opening),this.trigger("close"),this.trigger("closing")}},t[e].prototype.closeAllOthers=function(){a.$allMenus.not(this.$menu).each(function(){var o=t(this).data(e);o&&o.close&&o.close()})},t[e].prototype.setPage=function(e){var s=this,i=this.conf[o];e&&e.length||(e=a.$body.find(i.pageSelector),i.noPageSelector.length&&(e=e.not(i.noPageSelector.join(", "))),e.length>1&&i.wrapPageIfNeeded&&(e=e.wrapAll("<"+this.conf[o].pageNodetype+" />").parent())),e.each(function(){t(this).attr("id",t(this).attr("id")||s.__getUniqueId())}),e.addClass(n.page+" "+n.slideout),a.$page=e,this.trigger("setPage",e)},t[e].prototype["_initWindow_"+o]=function(){a.$wndw.off(i.keydown+"-"+o).on(i.keydown+"-"+o,function(t){if(a.$html.hasClass(n.opened)&&9==t.keyCode)return t.preventDefault(),!1});var t=0;a.$wndw.off(i.resize+"-"+o).on(i.resize+"-"+o,function(e,o){if(1==a.$page.length&&(o||a.$html.hasClass(n.opened))){var s=a.$wndw.height();(o||s!=t)&&(t=s,a.$page.css("minHeight",s))}})},t[e].prototype._initBlocker=function(){var e=this;this.opts[o].blockUI&&(a.$blck||(a.$blck=t('<div id="'+n.blocker+'" class="'+n.slideout+'" />')),a.$blck.appendTo(a.$body).off(i.touchstart+"-"+o+" "+i.touchmove+"-"+o).on(i.touchstart+"-"+o+" "+i.touchmove+"-"+o,function(t){t.preventDefault(),t.stopPropagation(),a.$blck.trigger(i.mousedown+"-"+o)}).off(i.mousedown+"-"+o).on(i.mousedown+"-"+o,function(t){t.preventDefault(),a.$html.hasClass(n.modal)||(e.closeAllOthers(),e.close())}))};var n,s,i,a}(jQuery);